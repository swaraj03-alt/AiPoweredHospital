<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Symptoms | Patient Dashboard</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background: #f8f9fa;
      font-family: 'Poppins', sans-serif;
    }

    /* Navbar */
    .navbar {
      background: #34495e;
      height: 65px;
      z-index: 1030;
    }
    .navbar-brand {
      color: #fff !important;
      font-weight: bold;
    }

    /* Sidebar */
    .sidebar {
      min-height: 100vh;
      background: #2c3e50;
      color: #fff;
      position: fixed;
      top: 65px; /* below navbar */
      left: 0;
      width: 240px;
      padding-top: 20px;
      overflow-y: auto;
    }

    .sidebar a {
      color: #fff;
      padding: 12px 20px;
      display: block;
      text-decoration: none;
      transition: background 0.3s;
    }
    .sidebar a:hover {
      background: #1abc9c;
    }

    /* Content Area */
    .content {
      margin-left: 240px;
      margin-top: 90px; /* offset for navbar */
      padding: 30px;
    }

    /* Cards */
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      background: #fff;
    }

    /* Table Header */
    .table thead {
      background: #2c3e50;
      color: #fff;
    }

    /* Button spacing */
    .btn {
      border-radius: 8px;
    }

    /* Make page scroll well on mobile */
    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      .content {
        margin-left: 0;
        margin-top: 90px;
        padding: 20px;
      }
    }
  </style>
</head>
<body>

  <!-- Top Navbar -->
  <nav class="navbar navbar-dark fixed-top px-3">
    <a class="navbar-brand" href="#"><i class="bi bi-hospital me-2"></i> Patient Dashboard</a>
    <div class="d-flex align-items-center">
      <a href="#" class="text-white me-3"><i class="bi bi-bell"></i></a>
      <a href="/patient-login" class="text-white"><i class="bi bi-box-arrow-right"></i></a>
    </div>
  </nav>

  <!-- Sidebar -->
  {% include 'patient/patient-sidebar.html' %}

  <!-- Main Content -->
<div class="content">
  <!-- Upload Symptoms Card -->
  <div class="card p-4 mb-4 shadow-sm">
    <h3 class="text-center mb-4 text-primary">
      <i class="bi bi-pencil-square me-2"></i> Upload Symptoms
    </h3>

    <form action="/upload-symptoms" method="POST" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="symptoms" class="form-label fw-semibold">Describe Your Symptoms</label>
        <textarea class="form-control" id="symptoms" name="user_input_text" rows="4" placeholder="Enter your symptoms here..." required></textarea>
      </div>
      <div class="mb-3">
        <label for="report" class="form-label fw-semibold">Upload Related File (optional)</label>
        <input type="file" class="form-control" id="report" name="user_input_file" accept=".pdf,.docx,.txt,.jpg,.png">
      </div>
      <div class="d-grid">
        <button type="submit" class="btn btn-primary"><i class="bi bi-upload me-2"></i>Submit Symptoms</button>
      </div>
    </form>

<!--    {% if response %}-->
<!--    <div class="mt-4 alert alert-info shadow-sm">-->
<!--      <strong>AI Response:</strong><br>-->
<!--      {{ response|replace('\n', '<br>')|safe }}-->
<!--    </div>-->
<!--    {% endif %}-->
  </div>

  <!-- Submitted Symptoms Table -->
  {% if submissions %}
  <div class="card p-4 shadow-sm">
    <h4 class="mb-3 text-primary">
      <i class="bi bi-list-check me-2"></i> Submitted Symptoms
    </h4>
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead class="text-center">
          <tr>
            <th>Patient ID</th>
            <th>Symptoms</th>
            <th>Report</th>
            <th>Date Submitted</th>
<!--            <th>Status</th>-->
<!--            <th>AI Response</th>-->
            <th>View</th>
          </tr>
        </thead>
        <tbody>
          {% for s in submissions %}
          <tr>
            <td>{{ s.patient_id }}</td>
            <td style="max-width: 300px; white-space: pre-line;">{{ s.symptoms }}</td>
            <td>
              {% if s.filename %}
                {% if s.filename.endswith('.pdf') %}
                  <a href="{{ url_for('static', filename='uploads/' + s.filename) }}" target="_blank" class="btn btn-sm btn-outline-danger"><i class="bi bi-file-earmark-pdf"></i> View PDF</a>
                {% elif s.filename.endswith('.jpg') or s.filename.endswith('.png') %}
                  <a href="{{ url_for('static', filename='uploads/' + s.filename) }}" target="_blank" class="btn btn-sm btn-outline-success"><i class="bi bi-image"></i> View Image</a>
                {% elif s.filename.endswith('.docx') %}
                  <a href="{{ url_for('static', filename='uploads/' + s.filename) }}" target="_blank" class="btn btn-sm btn-outline-primary"><i class="bi bi-file-earmark-word"></i> View DOCX</a>
                {% elif s.filename.endswith('.txt') %}
                  <a href="{{ url_for('static', filename='uploads/' + s.filename) }}" target="_blank" class="btn btn-sm btn-outline-secondary"><i class="bi bi-file-earmark-text"></i> View TXT</a>
                {% else %}
                  <a href="{{ url_for('static', filename='uploads/' + s.filename) }}" target="_blank" class="btn btn-sm btn-outline-dark"><i class="bi bi-file-earmark"></i> View File</a>
                {% endif %}
              {% else %}
                <span class="text-muted">No Report</span>
              {% endif %}
            </td>

            <td>{{ s.created_at.strftime('%Y-%m-%d %H:%M') if s.created_at else 'N/A' }}</td>
<!--            <td>-->
<!--              {% if s.status == 'pending' %}-->
<!--                <span class="badge bg-warning text-dark">Pending</span>-->
<!--              {% elif s.status == 'completed' %}-->
<!--                <span class="badge bg-success">Completed</span>-->
<!--              {% else %}-->
<!--                <span class="badge bg-secondary">{{ s.status }}</span>-->
<!--              {% endif %}-->
<!--            </td>-->
<!--            <td>-->
<!--              {% if s.ai_response %}-->
<!--                <button class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#aiModal{{ loop.index }}">-->
<!--                  <i class="bi bi-robot"></i> View-->
<!--                </button>-->

<!--                &lt;!&ndash; AI Response Modal &ndash;&gt;-->
<!--                <div class="modal fade" id="aiModal{{ loop.index }}" tabindex="-1" aria-hidden="true">-->
<!--                  <div class="modal-dialog modal-dialog-centered">-->
<!--                    <div class="modal-content">-->
<!--                      <div class="modal-header">-->
<!--                        <h5 class="modal-title">AI Response</h5>-->
<!--                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>-->
<!--                      </div>-->
<!--                      <div class="modal-body">-->
<!--                        <p>{{ s.ai_response|replace('\n', '<br>')|safe }}</p>-->
<!--                      </div>-->
<!--                    </div>-->
<!--                  </div>-->
<!--                </div>-->
<!--              {% else %}-->
<!--&lt;!&ndash;                <span class="text-muted">Pending</span>&ndash;&gt;-->
<!--              {% endif %}-->
<!--            </td>-->
            <td>
              <a href="{{ url_for('view_prescription', symptom_id=s.aid) }}" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye"></i> View
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
</div>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
